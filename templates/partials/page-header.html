{{define "page-header"}}
    <header class="margin-start-5xl" hx-get="/page-header/{{.CurrentFile.ID}}" hx-trigger="padd:reload-header from:body"
            hx-swap="outerHTML">

        <!-- Breadcrumb Navigation -->
        {{template "breadcrumbs" .}}

        <!-- Title and Actions -->
        <div class="split align-center margin-end-s">
            <div class="stack gap-4xs">

                <div class="cluster align-center gap-5xs">
                    {{if .Encrypted}}
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 1L20.2169 2.82598C20.6745 2.92766 21 3.33347 21 3.80217V13.7889C21 15.795 19.9974 17.6684 18.3282 18.7812L12 23L5.6718 18.7812C4.00261 17.6684 3 15.795 3 13.7889V3.80217C3 3.33347 3.32553 2.92766 3.78307 2.82598L12 1ZM12 3.04879L5 4.60434V13.7889C5 15.1263 5.6684 16.3752 6.7812 17.1171L12 20.5963L17.2188 17.1171C18.3316 16.3752 19 15.1263 19 13.7889V4.60434L12 3.04879ZM12 7C13.1046 7 14 7.89543 14 9C14 9.73984 13.5983 10.3858 13.0011 10.7318L13 15H11L10.9999 10.7324C10.4022 10.3866 10 9.74025 10 9C10 7.89543 10.8954 7 12 7Z"></path>
                        </svg>
                    {{end}}
                    <h1>{{.Title}}</h1>
                </div>
                {{if .Description}}
                    <p class="text-muted size-s">{{.Description}}</p>
                    {{if .CurrentFile.IsCSV }}
                        <p class="text-muted size-xs">
                            {{.CSVData.RecordCount}} rows × {{.CSVData.ColumnCount}} columns
                            {{if .CSVData.Metadata.SortColumn}}
                                • Sorted by {{.CSVData.Metadata.SortColumn}}{{if .CSVData.Metadata.SortDesc}} (desc){{end}}
                            {{end}}
                        </p>
                    {{end}}
                {{end}}
                {{if or .CreatedAt .UpdatedAt}}
                    <p class="text-muted size-xs cluster">
                        {{if .CreatedAt}}<span>Created: {{.CreatedAt}}</span>{{end}}
                        {{if .UpdatedAt}}<span>Updated: {{.UpdatedAt}}</span>{{end}}
                    </p>
                {{end}}
            </div>

            <!-- Action Buttons -->
            <div class="cluster gap-2xs">
                {{if hasPrefix .CurrentFile.Path "daily"}}
                    <button command="show-modal" commandfor="entry-modal-daily" class="primary outline size-xs">
                        Daily Entry
                    </button>
                {{else if hasPrefix .CurrentFile.Path "journal"}}
                    <button command="show-modal" commandfor="entry-modal-journal" class="primary outline size-xs">
                        Journal Entry
                    </button>
                {{else}}
                    {{if not .CurrentFile.IsCSV}}
                        {{if .HasCompletedTasks}}
                            <button hx-post="/tasks/complete/{{.CurrentFile.ID}}"
                                    hx-swap="none"
                                    hx-confirm="This will move completed tasks to a daily entry for today. Are you sure?"
                                    class="btn danger outline size-2xs">
                                Archive Completed
                            </button>
                        {{end}}
                        <button command="show-modal" commandfor="entry-modal-quick" class="primary outline size-xs">
                            Add an Entry
                        </button>
                    {{end}}
                {{end}}
                <a href="/edit/{{.CurrentFile.ID}}" class="btn outline size-2xs">Edit</a>
            </div>
        </div>

        <!-- Metadata Section -->
        {{if or .Status .Priority .DueDate .Category .Tags .Contexts .HasTasks}}
            <div class="metadata-section margin-end-s stack gap-2xs">
                <!-- Organizational Metadata -->
                {{if .Category}}
                    <div class="cluster gap-m size-s">
                        {{if .Category}}
                            <div class="metadata-item">
                                <span class="text-muted">Category:</span>
                                <a href="/search?q={{.Category}}" class="link">{{.Category}}</a>
                            </div>
                        {{end}}
                    </div>
                {{end}}

                <!-- Task Counts -->
                {{if .HasTasks}}
                    <div class="cluster gap-2xs">
                        <div class="metadata-item">
                            <span class="text-muted">
                                Tasks: <strong>{{.TasksCompleted}}</strong> of <strong>{{.TasksTotal}}</strong> tasks completed
                            </span>
                        </div>
                    </div>
                {{end}}

                <!-- Status/Priority Badges -->
                {{if or .Status .Priority .DueDate}}
                    <div class="cluster gap-3xs">
                        {{if .Status}}
                            <span class="badge {{.StatusColor}}">Status: {{.Status}}</span>
                        {{end}}
                        {{if .Priority}}
                            <span class="badge {{.PriorityColor}}">Priority: {{.Priority}}</span>
                        {{end}}
                        {{if .DueDate}}
                            <span class="badge {{.DueColor}}">Due: {{.DueDate}}</span>
                        {{end}}
                    </div>
                {{end}}

                <!-- Tags and Contexts -->
                {{if or .Tags .Contexts}}
                    <div class="cluster gap-2xs wrap">
                        {{range .Tags}}
                            <a href="/search?q={{.}}" class="badge {{$.TagColor}}">{{.}}</a>
                        {{end}}
                        {{range .Contexts}}
                            <a href="/search?q={{.}}" class="badge {{$.ContextColor}}">{{.}}</a>
                        {{end}}
                    </div>
                {{end}}

            </div>
        {{end}}

        <hr>
    </header>
{{end}}

