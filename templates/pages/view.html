{{template "base.html" .}}

{{define "content"}}
    <article class="margin-end-6xl {{if .CurrentFile.IsTemporal}}temporal-file{{end}}">

        {{template "page-header" .}}

        <div class="margin-end-xl size-xs">
            <kelp-toc target="#content-display"></kelp-toc>
        </div>

        {{if hasPrefix .CurrentFile.Path "daily/"}}
            {{template "entry-modal" (dict "ID" "daily" "Title" "Add Daily Entry" "Action" "/daily" "Placeholder" "What did you do?")}}
        {{else if hasPrefix .CurrentFile.Path "journal/"}}
            {{template "entry-modal" (dict "ID" "journal" "Title" "Add Journal Entry" "Action" "/journal" "Placeholder" "Thoughts, ideas, reflections...")}}
        {{else}}
            {{$addAction := printf "/add/%s" .CurrentFile.ID}}
            {{template "entry-modal" (dict "ID" "quick" "Title" "Add an Entry" "Action" $addAction "Placeholder" "What's on your mind?" "ShowAsTask" true "ShowHeader" true "SectionHeaders" .SectionHeaders)}}
        {{end}}

        <div id="content-display" class="content-display">
            <kelp-heading-anchors before>
                {{.Content}}
            </kelp-heading-anchors>
        </div>
    </article>
{{end}}

{{define "entry-modal"}}
    <dialog id="entry-modal-{{.ID}}" closedby="any">
        <form action="{{.Action}}" method="post">
            {{if .ShowHeader}}
                <label for="section_header" class="visually-hidden">Section Header</label>
                <input type="text"
                       autofocus
                       list="section-headers" id="section_header"
                       name="section_header" placeholder="Section Header"
                       value="{{.Header}}"
                       class="margin-end-6xs">
                <p class="text-muted size-2xs">(Leave blank to add to the top of the file)</p>
                <datalist id="section-headers">
                    {{range .SectionHeaders}}
                    <option value="{{.}}">
                        {{end}}
                </datalist>
            {{end}}

            <label for="entry" class="visually-hidden">{{.Title}}</label>
            <kelp-autogrow>
                <textarea id="entry" name="entry" rows="3" placeholder="{{.Placeholder}}" required></textarea>
            </kelp-autogrow>

            {{if .ShowAsTask}}
                <label for="as_task" class="margin-start-2xs">
                    <input type="checkbox" id="as_task" name="as_task" value="true">
                    Add as a Task
                </label>
            {{end}}

            <button type="submit" class="margin-start-3xs primary">{{.Title}}</button>
        </form>
    </dialog>
{{end}}
